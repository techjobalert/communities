%h3
  Your Colleagues

  .light-button.send-message.green#send-message-dialog
    %b Send
    your followers a message

.b-colleagues.list
  .list-header
    .nav.account
      = link_to users_path(:tab => "followers"), :remote => true, :class => "followers #{ 'selected' if @tab == 'followers'}" do
        %span
        Followers
      = link_to users_path(:tab => "published_together"), :remote => true, :class => "published-together #{ 'selected' if @tab == 'published_together'}" do
        %span
        Published
        %br
        together
      = link_to users_path(:tab => "following"), :remote => true, :class => "following #{ 'selected' if @tab == 'following'}" do
        %span
        Following
      = link_to users_path(:tab => "patients"), :remote => true, :class => "patients #{ 'selected' if @tab == 'patients'}" do
        %span
        Patients
    .filter.account
      .field
        .tags
          .label Filter by
          = form_for '/' do |f|
            = hidden_field_tag "filter_type" , "#{@tab}"
            -if @tab != 'patients'
              = f.select "", ['Degree','Degree']
              = f.select "", ['Location','Location']
              = f.select "", ['Specialization','Specialization']
              = f.select "", ['Num’ of publishing','Num’ of publishing']
            - elsif @tab == 'patients'
              = f.select "", ['Location','Location']

          .clear
        .search
          = form_tag root_path, :remote => true, :method => :get do
            = text_field_tag "q", nil, :value => params[:q] ,:placeholder => 'Free search', :class => 'text-input', :id => "qsearch"
            = hidden_field_tag "filter_type" , "#{@tab}"
            = submit_tag 'Go', :class => 'dark-button'
        .clear
    .clear
    .list-content
      .b-colleagues-container
        = render :partial => "colleagues_list", :locals => {:users => users}

%div{ :id => "send-message", :title=>"Send message to your followers", :style=>"display:none;" }
  %p
    %textarea

:javascript
  $( "#send-message:ui-dialog" ).dialog( "destroy" );

  $( "#send-message" ).dialog({
    resizable: false,
    autoOpen: false,
    width: 400,
    modal: true,
    buttons: {
      "Send message": function() {
        $.ajax({
          type: 'POST',
          url: '#{user_send_message_to_followers_path(current_user)}',
          data: { 'message': {'body': $( "#send-message>p>textarea")[0].value } },
          dataType: 'script'
        });
      },
      Cancel: function() {
        $( this ).dialog( "close" );
      }
    }
  });
  $( "#send-message-dialog" ).click(function() {
      $( "#send-message" ).dialog( "open" );
      return false;
    });

  $("#qsearch").autocomplete({
    source: "/search/qsearch-user",
    minLength: 3,
    width: 100,
    select: function(event, ui) {
      return window.location.assign(ui.item.url);
    }
    }).data("autocomplete")._renderItem = function(ul, item) {
      return $("<li></li>").addClass("qsearch-item").data("item.autocomplete", item).append("<a href=\"" + item.url + "\">" + item.title + "</a>").appendTo(ul);
    };