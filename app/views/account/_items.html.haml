%h3
  Your Account

.clear

.list
  .list-header
    = render :partial => "navigation"
    .list-content
      - if items.present?
        - items.each do |item|
          .item{:class => "#{item.state}", :id => "item-#{item.id}"}
            .tools
              - price = item.price > 0 ? "#{item.price}$" : 'free'
              .price
                Price: 
                %span= price

              = link_to 'Change price', '#', :class => 'change', :id => "change-price-#{item.id}" unless item.moderated?
              = link_to item_path(item), :method => "delete", :remote => true , :confirm => 'Are you sure?', :class => 'delete no-history' do
                Delete Item
                %span
            .media
              = image_tag '/assets/tmp/p2.png'
              .info
                .purchase
                  %span
                  = "Purchase: #{item.amount}"
                .view
                  %span
                  = "Views: #{item.views_count}"

            .text= item.description
          %div{ :class => "change-price-form", :id => "form-change-price-#{item.id}", :title=>"Change price", :style => "display: none;" }
            .form
              = form_for item, :remote => true, :method => :put do |f|
                = hidden_field_tag "type" , "change_price"
                %p
                  = f.label :price
                  = f.text_field :price
        .clear
        = paginate items, :remote => true
        .clear

:javascript
  $( ".change-price-form:ui-dialog" ).dialog( "destroy" );

  $( ".change-price-form" ).dialog({
    resizable: false,
    autoOpen: false,
    width: 410,
    modal: true,
    buttons: {
      "Change price": function() {
        $( this ).find('form').submit();
        $( this ).dialog( "close" );
      },
      Cancel: function() {
        $( this ).dialog( "close" );
      }
    }
  });
  $( "a.change" ).click(function() {
      var id = $(this).attr("id")
      $( "#form-" + id ).dialog( "open" );
      return false;
    });
